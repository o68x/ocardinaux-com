---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";

export interface Props {
  src: ImageMetadata;
  alt: string;
  class?: string;
}

const { src, alt, class: className } = Astro.props;

const filename = src.src.split("/").pop();
const filenameWithoutExtension = filename?.split(".")[0];

const hasContent = Astro.slots.has("default");
console.log(filenameWithoutExtension,hasContent);

---

<div
  class:list={[className, "screenshot"]}
  id={filenameWithoutExtension}
  data-img="screenshot"
>
  <figure>
    <Image
      src={src}
      alt={alt}
      style=`aspect-ratio: ${src.width / src.height};`
    />
    <figcaption>{alt}</figcaption>
  </figure>
  {hasContent && <div class="backside"><slot /></div>}
</div>

<style>
  @keyframes show-backside {
    0% {
      transform: rotate3d(20, 40, 0, 30deg);
      opacity: 1;
    }
    100% {
      transform: rotate3d(20, 40, 0, 90deg) scale(0.5);
      opacity: 0;
    }
  }

  @keyframes show-frontside {
    0% {
      transform: rotate3d(20, 40, 0, 90deg) scale(0.5);
      opacity: 0;
    }
    100% {
      transform: rotate3d(20, 40, 0, 30deg);
      opacity: 1;
    }
  }

  .screenshot {
    z-index: 1;

    & > figure {
      padding: var(--s-1);
      position: relative;
    }

    & figcaption {
      text-align: center;
      font-size: var(--s-2);
    }

    & img {
      width: 100%;
      transform: rotate3d(20, 40, 0, 30deg);
      filter: drop-shadow(var(--s-5) var(--s-5) 10px rgb(0 0 0 / 0.2));
      transform-origin: center;
      height: auto;
      object-fit: contain;
      padding: var(--s-5);
      will-change: transform;
      transition: filter 0.5s ease-in-out;
    }

    & .backside {
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
      transition: opacity 0.2s ease-in;
      font-size: var(--s0);
      font-variation-settings: "wght" 400, "wdth" 75;
      padding: var(--s-3);
      color: var(--color-very-dark-bone);
    }

    &.show-back:has(.backside) {
      img {
        animation-name: show-backside;
        animation-duration: 0.4s;
        animation-timing-function: ease-in-out;
        animation-fill-mode: both;
      }

      .backside {
        opacity: 1;
      }
    }

    &.show-home:has(.backside) {
      img {
        animation-name: show-frontside;
        animation-duration: 0.2s;
        animation-timing-function: ease-in-out;
        animation-fill-mode: both;
      }

      .backside {
        opacity: 0;
      }
    }

  }
</style>

<script>
  const imgs = document.querySelectorAll("[data-img='screenshot']");
  imgs.forEach((img) => {
    img.addEventListener("mouseenter", () => {
      img.classList.add("show-back");
      img.classList.remove("show-home");
    });
    img.addEventListener("mouseleave", () => {
      img.classList.remove("show-back");
      img.classList.add("show-home");
    });
  });
</script>
